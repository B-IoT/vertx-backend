version: '2.1'
orbs:
  path-filtering: circleci/path-filtering@0.0.2
# This allows you to use CircleCI's dynamic configuration feature
setup: true
parameters:
  run-backend-services-job:
    type: boolean
    default: false
  run-triangulation-service-job:
    type: boolean
    default: false
workflows:
  generate-config:
    jobs:
      - path-filtering/filter:
          # 3-column, whitespace-delimited mapping. One mapping per line: <regex path-to-test> <parameter-to-set> <value-of-pipeline-parameter>.
          mapping: |
            crud/.* run-backend-services-job true
            public-api/.* run-backend-services-job true
            relays-communication/.* run-backend-services-job true
            triangulation/.* run-triangulation-service-job true
          base-revision: main
          # this is the path of the configuration we should trigger once path filtering and pipeline parameter value updates are complete. In this case, we are using the parent dynamic configuration itself.
          config-path: .circleci/continue_config.yml